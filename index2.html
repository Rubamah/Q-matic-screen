<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shared Grid 1â€“500</title>

<!-- Firebase compat SDK (no build tools needed) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:20px}
  h1{margin:0 0 10px}
  .ranges{margin:0 0 15px;display:flex;gap:8px;flex-wrap:wrap}
  .ranges button{padding:8px 12px;border:1px solid #666;border-radius:6px;background:#fff;cursor:pointer}
  .ranges button.active{background:#333;color:#fff;border-color:#333}
  .grid{display:none;grid-template-columns:repeat(10,1fr);gap:6px;margin-bottom:20px}
  .grid.active{display:grid}
  .cell{border:1px solid #555;border-radius:4px;padding:10px;text-align:center;cursor:pointer;user-select:none;background:#f7f7f7}
  .cell.on{background:#000;color:#fff}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .controls button{padding:8px 12px;border:1px solid #666;border-radius:6px;background:#fff;cursor:pointer}
</style>
</head>
<body>
  <h1>Shared Number Grid (1â€“500)</h1>

  <div class="ranges" id="ranges"></div>
  <div id="grids"></div>

  <div class="controls">
    <button id="clearBtn">Clear Colors</button>
  </div>

<script>
// ===== Firebase config (from your project) =====
const firebaseConfig = {
  apiKey: "AIzaSyCWWnMsge75Q3_MDF9Aj9wo4C5KD6RVGfw",
  authDomain: "q-matic-b7d77.firebaseapp.com",
  databaseURL: "https://q-matic-b7d77-default-rtdb.firebaseio.com",
  projectId: "q-matic-b7d77",
  storageBucket: "q-matic-b7d77.firebasestorage.app",
  messagingSenderId: "908187704899",
  appId: "1:908187704899:web:b8bcf33cda90bafe81bef6",
  measurementId: "G-VT1P6V5TEY"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Build UI =====
const rangesEl = document.getElementById("ranges");
const gridsEl  = document.getElementById("grids");
const grids = [], buttons = [], cells = [];

for (let r = 0; r < 5; r++) {
  const start = r*100 + 1, end = (r+1)*100;

  // range button
  const btn = document.createElement("button");
  btn.textContent = `${start}â€“${end}`;
  btn.addEventListener("click", () => showGrid(r));
  rangesEl.appendChild(btn);
  buttons.push(btn);

  // grid of 100 numbers
  const grid = document.createElement("div");
  grid.className = "grid";
  for (let n = start; n <= end; n++) {
    const div = document.createElement("div");
    div.textContent = n;
    div.className = "cell";
    div.addEventListener("click", () => toggleCell(n));
    grid.appendChild(div);
    cells[n] = div;
  }
  grids.push(grid);
  gridsEl.appendChild(grid);
}

function showGrid(r) {
  grids.forEach((g, i) => g.classList.toggle("active", i === r));
  buttons.forEach((b, i) => b.classList.toggle("active", i === r));
}
showGrid(0);

// ===== Realtime sync =====
db.ref("grid").on("value", snap => {
  const data = snap.val() || {};
  for (let i = 1; i <= 500; i++) {
    if (cells[i]) cells[i].classList.toggle("on", !!data[i]);
  }
});

function toggleCell(num) {
  const ref = db.ref("grid/"+num);
  ref.once("value").then(snap => {
    const newState = !snap.val();
    ref.set(newState);

    // ðŸ”¹ also update "latest"
    db.ref("latest").set({
      number: num,
      isOn: newState,
      ts: Date.now()
    });
  });
}

document.getElementById("clearBtn").addEventListener("click", () => {
  db.ref("grid").set({});
  db.ref("latest").set(null);
});
</script>
</body>
</html>
